#!/bin/bash

# Script that adds changes to README.md without needing README.md in home directory.
# You can then commit the changes and push.
# Useful command: dots ls-files -v|grep '^h' (lists ingored files)

readme="$1"

dots() {
    git --git-dir=$HOME/.dots.git/ --work-tree=$HOME "$@"
}

update() {
    cp $readme $HOME
    printf "Copied README.md to home directory.\n"

    dots update-index --no-assume-unchanged $HOME/README.md
    printf "Unignored README.md.\n"

    dots add $HOME/README.md
    printf "Added README.md.\n"

    dots update-index --assume-unchanged $HOME/README.md
    printf "Ingored README.md once more.\n"

    rm $HOME/README.md
    printf "Removed README.md from home directory.\n"
}

usage() {
    printf "usage: dots-update-README <path/to/dots/README.md>\n"
    exit "1"
}

if [[ -f $readme && ($readme == */README.md || $readme == README.md) ]] ; then
    update
else
    usage
fi
